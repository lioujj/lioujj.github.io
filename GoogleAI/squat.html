<!DOCTYPE html><html><head><meta charset='utf-8'><meta http-equiv='Access-Control-Allow-Origin' content='*'><meta http-equiv='Access-Control-Allow-Credentials' content='true'><script src='https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script><script src='https://fustyles.github.io/webduino/SpBlocklyJS/GameElements_20190131/gameelements.js'></script><script src='https://fustyles.github.io/webduino/SpBlocklyJS/holistic_20201012/holistic_video.js'></script><script src='https://fustyles.github.io/webduino/SpBlocklyJS/holistic_20201012/holistic.js'></script><script src='https://fustyles.github.io/webduino/SpBlocklyJS/TextToSpeech_20220729/texttospeech.js'></script></head><body><script>const delay=(seconds)=>{return new Promise((resolve)=>{setTimeout(resolve,seconds*1000);});};const main=async()=>{var detectPeriod, inPosition, myCounts, seconds, stayTime, leftHip, leftFoot, rightHip, rightFoot, myTimer;


detectPeriod = false;
inPosition = false;
myCounts = 0;
seconds = 0;
stayTime = 2;
leftHip = 0;
leftFoot = 0;
rightHip = 0;
rightFoot = 0;
span_create('',700,20,50,'',999);
span_set('',"color",(HextoRgb('#000000')));
span_set('',"innerHTML",'設定深蹲停留秒數：');
text_create('',60,50,1150,25,'#ffffff','#000000',50,1,stayTime,999,true);
button_create('',120,70,1230,20,1,null,'確認',50,999,true);
async function gamebutton__onclick (event) {
  stayTime = (text_to_number((text_get('',"value"))));
};
document.getElementById("gamebutton_").addEventListener("click", gamebutton__onclick, true);
span_create('spanCounts',700,120,50,'',999);
span_set('spanCounts',"color",(HextoRgb('#000099')));
span_set('spanCounts',"innerHTML",('目前深蹲次數：' + String(myCounts)));
span_create('spanSeconds',700,220,100,'',999);
span_set('spanSeconds',"color",(HextoRgb('#ff0000')));
span_set('spanSeconds',"innerHTML",'');
holistic_startvideo_media(640,480,"front",0);
holistic_video("block","0","1","0","0","1","1");
holistic_recognitionFinish = async function() {
holistic_state(0);
  leftFoot = (holistic_pose_position("29","y"));
  leftHip = (holistic_pose_position("23","y"));
  rightFoot = (holistic_pose_position("30","y"));
  rightHip = (holistic_pose_position("24","y"));
  if (leftFoot > 400 && leftFoot < 480 && rightFoot > 400 && rightFoot < 480) {
    if (leftFoot - leftHip < 90 && rightFoot - rightHip < 90) {
      inPosition = true;
      if (!detectPeriod) {
        detectPeriod = true;
        seconds = 0;
        myTimer = setInterval(async function(){
          seconds = (typeof seconds === 'number' ? seconds : 0) + 1;
          if (seconds > stayTime) {
            if (inPosition) {
              span_set('spanSeconds',"innerHTML",(String(seconds) + '秒'));
            } else {
              myCounts = (typeof myCounts === 'number' ? myCounts : 0) + 1;
              span_set('spanCounts',"innerHTML",('目前深蹲次數：' + String(myCounts)));
              ttsSetVoice(("Microsoft Hanhan - Chinese (Traditional, Taiwan)"));
              tts.text = (['深蹲',myCounts,'次'].join(''));
              synth.speak(tts);
              detectPeriod = false;
              clearInterval(myTimer);
            }
          } else {
            if (inPosition) {
              span_set('spanSeconds',"innerHTML",(String(seconds) + '秒'));
            } else {
              ttsSetVoice(("Microsoft Hanhan - Chinese (Traditional, Taiwan)"));
              tts.text = '深蹲秒數不足';
              synth.speak(tts);
              detectPeriod = false;
              clearInterval(myTimer);
            }
          }
        },1000);
      }
    } else {
      inPosition = false;
      span_set('spanSeconds',"innerHTML",'');
    }
  } else {
    detectPeriod = false;
    inPosition = false;
  }

holistic_state(1);};
};main();</script></body></html>